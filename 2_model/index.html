<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <title>Модель данных - Lab 1</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "\u041c\u043e\u0434\u0435\u043b\u044c \u0434\u0430\u043d\u043d\u044b\u0445";
        var mkdocs_page_input_path = "2_model.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href=".." class="icon icon-home"> Lab 1
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="..">Описание</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../1_tema/">Тема</a>
                </li>
              </ul>
              <ul class="current">
                <li class="toctree-l1 current"><a class="reference internal current" href="./">Модель данных</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#enum">Перечисления (Enum):</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#gender">Пол (Gender):</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#role">Роль (Role):</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#requeststatus">Статус запроса (RequestStatus):</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#_2">Классы моделей:</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#skilluserlink">Связь между пользователем и навыком (SkillUserLink):</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#membership">Членство в команде (MemberShip):</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#skill">Навык (Skill):</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#team">Команда (Team):</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#user">Пользователь (User):</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#task">Задача (Task):</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#solution">Решение (Solution):</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#comment">Комментарий (Comment):</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#_3">Код:</a>
    </li>
    </ul>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../3_API/">API</a>
                </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="..">Lab 1</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href=".." class="icon icon-home" aria-label="Docs"></a></li>
      <li class="breadcrumb-item active">Модель данных</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="_1">Модель данных</h1>
<h2 id="enum">Перечисления (Enum):</h2>
<h3 id="gender">Пол (Gender):</h3>
<p>Определяет перечисление для пола пользователя в системе. </p>
<ul>
<li><code>male</code> - Мужской</li>
<li><code>female</code> - Женский</li>
</ul>
<h3 id="role">Роль (Role):</h3>
<p>Определяет перечисление для ролей пользователя, включая администратора, участника и экзаменатора.</p>
<ul>
<li><code>admin</code> - Администратор</li>
<li><code>participant</code> - Участник</li>
<li><code>examiner</code> - Экзаменатор</li>
</ul>
<h3 id="requeststatus">Статус запроса (RequestStatus):</h3>
<p>Определяет состояние запроса, включая ожидание, принято, отклонено, отменено и создано.</p>
<ul>
<li><code>pending</code> - В ожидании</li>
<li><code>accepted</code> - Принят</li>
<li><code>rejected</code> - Отклонён</li>
<li><code>cancelled</code> - Отменён</li>
<li><code>created</code> - Создан</li>
</ul>
<h2 id="_2">Классы моделей:</h2>
<h3 id="skilluserlink">Связь между пользователем и навыком (SkillUserLink):</h3>
<p>Таблица связи между пользователем и навыком, позволяющая управлять отношениями между этими сущностями.</p>
<ul>
<li><code>skill_id</code> - ID навыка</li>
<li><code>user_id</code> - ID пользователя</li>
</ul>
<h3 id="membership">Членство в команде (MemberShip):</h3>
<p>Сохраняет информацию о присоединении пользователя к команде, включая статус запроса и сообщение запроса.</p>
<ul>
<li><code>team_id</code> - ID команды</li>
<li><code>user_id</code> - ID пользователя</li>
<li><code>request_status</code> - Статус запроса</li>
<li><code>request_message</code> - Сообщение запроса</li>
</ul>
<h3 id="skill">Навык (Skill):</h3>
<p>Определяет подробную информацию о навыке, включая идентификатор, название, описание и список связанных пользователей.</p>
<ul>
<li><code>id</code> - ID</li>
<li><code>name</code> - Название</li>
<li><code>description</code> - Описание</li>
<li><code>users</code> - Пользователи, связанные с этим навыком</li>
</ul>
<h3 id="team">Команда (Team):</h3>
<p>Определяет подробную информацию о команде, включая идентификатор, название, дату создания и список участников и решений команды.</p>
<ul>
<li><code>id</code> - ID</li>
<li><code>name</code> - Название</li>
<li><code>creation_date</code> - Дата создания</li>
<li><code>users</code> - Пользователи, состоящие в этой команде</li>
<li><code>solutions</code> - Решения, связанные с этой командой</li>
</ul>
<h3 id="user">Пользователь (User):</h3>
<p>Определяет подробную информацию о пользователе, включая идентификатор, информацию о пользователе, список навыков и список команд, в которых участвует пользователь</p>
<ul>
<li><code>id</code> - ID</li>
<li><code>name</code> - Имя</li>
<li><code>username</code> - Имя пользователя</li>
<li><code>password</code> - Пароль</li>
<li><code>email</code> - Электронная почта</li>
<li><code>telephone</code> - Телефон</li>
<li><code>registration_date</code> - Дата регистрации</li>
<li><code>status</code> - Статус</li>
<li><code>role</code> - Роль</li>
<li><code>gender</code> - Пол</li>
<li><code>skills</code> - Навыки, связанные с этим пользователем</li>
<li><code>teams</code> - Команды, в которых состоит этот пользователь</li>
</ul>
<h3 id="task">Задача (Task):</h3>
<p>Определяет подробную информацию о задаче, включая идентификатор, информацию о задаче и список решений для этой задачи.</p>
<ul>
<li><code>id</code> - ID</li>
<li><code>name</code> - Название</li>
<li><code>description</code> - Описание</li>
<li><code>requirements</code> - Требования</li>
<li><code>evaluation_criteria</code> - Критерии оценки</li>
<li><code>publish_date</code> - Дата публикации</li>
<li><code>solutions</code> - Решения, связанные с этой задачей</li>
</ul>
<h3 id="solution">Решение (Solution):</h3>
<p>Определяет подробную информацию о решении, включая идентификатор, содержание, дату представления, команду и задачу, связанные с этим решением, а также список комментариев.</p>
<ul>
<li><code>id</code> - ID</li>
<li><code>content</code> - Содержание</li>
<li><code>submission_date</code> - Дата подачи</li>
<li><code>team_id</code> - ID команды</li>
<li><code>task_id</code> - ID задачи</li>
<li><code>team</code> - Команда, связанная с этим решением</li>
<li><code>task</code> - Задача, связанная с этим решением</li>
</ul>
<h3 id="comment">Комментарий (Comment):</h3>
<p>Определяет подробную информацию о комментарии, включая идентификатор, содержание, дату создания, пользователя и решение, связанные с этим комментарием.</p>
<ul>
<li><code>id</code> - ID</li>
<li><code>content</code> - Содержание</li>
<li><code>creation_date</code> - Дата создания</li>
<li><code>solution_id</code> - ID решения</li>
<li><code>user_id</code> - ID пользователя</li>
<li><code>user</code> - Пользователь, связанный с этим комментарием</li>
<li><code>solution</code> - Решение, связанное с этим комментарием</li>
</ul>
<h2 id="_3">Код:</h2>
<pre><code class="language-python">from typing import Optional, List
from email_validator import EmailNotValidError
from sqlmodel import SQLModel, Field, Relationship
from datetime import datetime, time, timedelta
from enum import Enum
from pydantic import EmailStr, field_validator, validate_email
class Gender(Enum):
    male = &quot;male&quot;
    female = &quot;female&quot;

class Role(Enum) :
    admin = &quot;admin&quot;
    participant = &quot;participant&quot;
    examiner = &quot;examiner&quot;

class TokenSchema(SQLModel):
    access_token: str
    refresh_token: str

class TokenPayload(SQLModel):
    sub: int = None
    exp: int = None


class UserInput(SQLModel):
    username: str
    password: str

class RequestStatus(Enum):
    pending = &quot;pending&quot;
    accepted = &quot;accepted&quot;
    rejected = &quot;rejected&quot;
    cancelled = &quot;cancelled&quot;
    created = &quot;created&quot;

class SkillUserLink(SQLModel, table=True):
    skill_id: Optional[int] = Field(
        default=None, foreign_key=&quot;skill.id&quot;, primary_key=True
    )
    user_id: Optional[int] = Field(
        default=None, foreign_key=&quot;user.id&quot;, primary_key=True
    )


class MemberShip(SQLModel, table=True) :
    team_id: Optional[int] = Field(
        default=None, foreign_key=&quot;team.id&quot;, primary_key=True
    )
    user_id: Optional[int] = Field(
        default=None, foreign_key=&quot;user.id&quot;, primary_key=True
    )
    request_status: Optional[str] = Field(default=RequestStatus.pending)  
    request_message: Optional[str] = None

class SkillDefault(SQLModel):
    name: str
    description: Optional[str] = &quot;&quot;


class Skill(SkillDefault, table=True):
    id: int = Field(default=None, primary_key=True)
    users: Optional[List[&quot;User&quot;]] = Relationship(
        back_populates=&quot;skills&quot;, link_model=SkillUserLink)

class ChangePasswordRequest(SQLModel):
    old_password: str
    new_password: str

class TeamCreateRequest(SQLModel):
    name: str
    user_id: int

class TeamDefault(SQLModel) :
    name : str
    creation_date : datetime = datetime.now()

class Team(TeamDefault,table = True) :
    id: int = Field(default=None, primary_key=True)
    users: Optional[List[&quot;User&quot;]] = Relationship(
        back_populates=&quot;teams&quot;, link_model=MemberShip)
    solutions : Optional[List[&quot;Solution&quot;]]  = Relationship(back_populates=&quot;team&quot;)

class UserDefault(SQLModel) :
    name: str
    username : str 
    password : str 
    email: str
    telephone : str
    registration_date : datetime = datetime.now()
    status: Optional[bool] = Field(default=False)
    role: Role = Field(default=Role.participant)
    gender : Gender

    @field_validator(&quot;email&quot;)
    @classmethod
    def validate_email(cls, value):
        try:
            validate_email(value)
        except EmailNotValidError:
            raise ValueError(&quot;Invalid email format&quot;)
        return value

class User(UserDefault,table=True):
    id: int = Field(default=None, primary_key=True)
    skills: Optional[List[Skill]] = Relationship(
        back_populates=&quot;users&quot;, link_model=SkillUserLink)
    teams : Optional[List[Team]] = Relationship(
        back_populates=&quot;users&quot;, link_model=MemberShip)
    comments:  Optional[List[&quot;Comment&quot;]] = Relationship(back_populates=&quot;user&quot;)

class TaskCreateRequest(SQLModel):
    user_id: int
    name : str
    description : str
    requirements : str
    evaluation_criteria : str
    publish_date : datetime  = datetime.now()

class TaskDefault(SQLModel) :
    name : str
    description : str
    requirements : str
    evaluation_criteria : str
    publish_date : datetime  = datetime.now()

class Task(TaskDefault,table = True) :
    id: int = Field(default=None, primary_key=True)
    solutions : Optional[List[&quot;Solution&quot;]] = Relationship(back_populates=&quot;task&quot;)

class SolutionDefault(SQLModel) :
    content : Optional[str] 
    submission_date : datetime =  datetime.now()
    team_id: Optional[int] = Field(default=None, foreign_key=&quot;team.id&quot;)
    task_id: Optional[int] = Field(default=None, foreign_key=&quot;task.id&quot;)

class Solution(SolutionDefault,table = True) :
    id: int = Field(default=None, primary_key=True)
    team: Optional[Team] = Relationship(back_populates=&quot;solutions&quot;)
    task : Optional[Task] = Relationship(back_populates=&quot;solutions&quot;)
    comments:  Optional[List[&quot;Comment&quot;]] = Relationship(back_populates=&quot;solution&quot;)

class CommentDefault(SQLModel) :
    content : Optional[str] 
    creation_date : datetime = datetime.now()
    solution_id: Optional[int] = Field(default=None, foreign_key=&quot;solution.id&quot;)
    user_id: Optional[int] = Field(default=None, foreign_key=&quot;user.id&quot;)

class Comment(CommentDefault, table = True) :
    id: int = Field(default=None, primary_key=True)
    user: Optional[User] = Relationship(back_populates=&quot;comments&quot;)
    solution : Optional[Solution]  = Relationship(back_populates=&quot;comments&quot;)

class TeamData(TeamDefault) :
    users: Optional[List[&quot;User&quot;]] = None
    solutions : Optional[List[&quot;Solution&quot;]]  = None
class UserData(UserDefault) :
    skills: Optional[List[Skill]] = None
    teams : Optional[List[Team]] = None

class SolutionData(SolutionDefault) :
    team: Optional[Team] = None
    task : Optional[Task] = None

class TaskData(TaskDefault) :

    solutions : Optional[List[&quot;Solution&quot;]] = None
</code></pre>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../1_tema/" class="btn btn-neutral float-left" title="Тема"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../3_API/" class="btn btn-neutral float-right" title="API">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
      <span><a href="../1_tema/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../3_API/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
